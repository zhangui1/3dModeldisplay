# ğŸš€ å®å¡”é¢æ¿é…ç½®é€ŸæŸ¥è¡¨ - 3Dæ¨¡å‹å¹³å°

## ğŸ“Œ æ ¸å¿ƒé…ç½®è¦ç‚¹ï¼ˆå¿…çœ‹ï¼ï¼‰

### âœ… å¿…é¡»é…ç½®çš„ 3 ä¸ªå…³é”®ç‚¹

#### 1ï¸âƒ£ å¯ç”¨ Range è¯·æ±‚æ”¯æŒï¼ˆè§£å†³ PLY åŠ è½½ 0% é—®é¢˜ï¼‰

åœ¨ Nginx é…ç½®çš„ `/models/` location ä¸­æ·»åŠ ï¼š
```nginx
add_header Accept-Ranges bytes always;
```

#### 2ï¸âƒ£ é…ç½® CORS è·¨åŸŸè®¿é—®

åœ¨ Nginx é…ç½®çš„ `/models/` location ä¸­æ·»åŠ ï¼š
```nginx
add_header Access-Control-Allow-Origin * always;
add_header Access-Control-Expose-Headers "Accept-Ranges, Content-Length, Content-Range" always;
```

#### 3ï¸âƒ£ è®¾ç½®æ­£ç¡®çš„ PLY æ–‡ä»¶ MIME ç±»å‹

åœ¨ Nginx é…ç½®çš„ `/models/` location ä¸­æ·»åŠ ï¼š
```nginx
types {
    application/octet-stream ply;
    model/obj obj;
    application/octet-stream stl;
}
```

---

## ğŸ¯ å®å¡”é¢æ¿å¿«é€Ÿæ“ä½œè·¯å¾„

### å®‰è£…è½¯ä»¶
```
å·¦ä¾§èœå• â†’ è½¯ä»¶å•†åº— â†’ æœç´¢ â†’ å®‰è£…
```
éœ€è¦å®‰è£…ï¼šNginxã€PM2ã€Nodeç‰ˆæœ¬ç®¡ç†å™¨

### ä¸Šä¼ æ–‡ä»¶
```
å·¦ä¾§èœå• â†’ æ–‡ä»¶ â†’ /www/wwwroot/ â†’ ä¸Šä¼ /è§£å‹
```

### é…ç½®ç½‘ç«™
```
å·¦ä¾§èœå• â†’ ç½‘ç«™ â†’ æ·»åŠ ç«™ç‚¹
æ ¹ç›®å½•ï¼š/www/wwwroot/3dModeldisplay/public
```

### ä¿®æ”¹ Nginx é…ç½®
```
ç½‘ç«™åˆ—è¡¨ â†’ è®¾ç½® â†’ é…ç½®æ–‡ä»¶ â†’ ç²˜è´´å®Œæ•´é…ç½® â†’ ä¿å­˜
```

### å¯åŠ¨ Node.js
```
è½¯ä»¶å•†åº— â†’ PM2 ç®¡ç†å™¨ â†’ è®¾ç½® â†’ æ·»åŠ é¡¹ç›®
å¯åŠ¨æ–‡ä»¶ï¼š/www/wwwroot/3dModeldisplay/server.js
ç«¯å£ï¼š3000
```

### æŸ¥çœ‹æ—¥å¿—
```
# Nginx æ—¥å¿—
ç½‘ç«™ â†’ æ—¥å¿—

# PM2 æ—¥å¿—
è½¯ä»¶å•†åº— â†’ PM2 ç®¡ç†å™¨ â†’ è®¾ç½® â†’ æŸ¥çœ‹æ—¥å¿—
```

---

## ğŸ”§ å¸¸ç”¨ç»ˆç«¯å‘½ä»¤

### è¿›å…¥é¡¹ç›®ç›®å½•
```bash
cd /www/wwwroot/3dModeldisplay
```

### å®‰è£…ä¾èµ–
```bash
npm install
# æˆ–ä½¿ç”¨å›½å†…é•œåƒ
npm install --registry=https://registry.npmmirror.com
```

### PM2 æ“ä½œ
```bash
# å¯åŠ¨åº”ç”¨
pm2 start server.js --name "3d-model-display"

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# é‡å¯åº”ç”¨
pm2 restart 3d-model-display

# åœæ­¢åº”ç”¨
pm2 stop 3d-model-display

# æŸ¥çœ‹æ—¥å¿—
pm2 logs 3d-model-display

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

### æƒé™è®¾ç½®
```bash
# è®¾ç½®ç›®å½•æƒé™
chmod -R 755 /www/wwwroot/3dModeldisplay/

# è®¾ç½®æ‰€æœ‰è€…
chown -R www:www /www/wwwroot/3dModeldisplay/
```

### æµ‹è¯• Range è¯·æ±‚
```bash
# æ›¿æ¢æ–‡ä»¶åå’ŒåŸŸå
curl -I -H "Range: bytes=0-1023" http://ä½ çš„IP/models/ä½ çš„æ–‡ä»¶.ply

# æ­£ç¡®å“åº”åº”è¯¥æ˜¯ï¼š
# HTTP/1.1 206 Partial Content
# Accept-Ranges: bytes
```

---

## ğŸ› é—®é¢˜è¯Šæ–­é€ŸæŸ¥

| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | å¿«é€Ÿè§£å†³ |
|---------|---------|---------|
| **æ¨¡å‹åŠ è½½å¡ 0%** | Range è¯·æ±‚æœªå¯ç”¨ | æ£€æŸ¥é…ç½®ä¸­ `Accept-Ranges` |
| **502 é”™è¯¯** | Node.js æœªå¯åŠ¨ | `pm2 restart 3d-model-display` |
| **403 é”™è¯¯** | æƒé™ä¸è¶³ | `chmod -R 755 /www/wwwroot/3dModeldisplay/` |
| **404 é”™è¯¯** | è·¯å¾„é…ç½®é”™è¯¯ | æ£€æŸ¥ Nginx `alias` è·¯å¾„ |
| **ä¸Šä¼ å¤±è´¥** | æ–‡ä»¶å¤§å°é™åˆ¶ | æ£€æŸ¥ `client_max_body_size 500M` |
| **CORS é”™è¯¯** | è·¨åŸŸé…ç½®ç¼ºå¤± | æ£€æŸ¥ `Access-Control-Allow-Origin` |
| **çŠ¶æ€ç  200 é 206** | Range å“åº”å¤´ç¼ºå¤± | æ·»åŠ  `Accept-Ranges: bytes always` |

---

## âœ… éªŒè¯æ£€æŸ¥æ¸…å•

### é…ç½®å®Œæˆåï¼ŒæŒ‰é¡ºåºæ£€æŸ¥ï¼š

1. **åŸºæœ¬è®¿é—®**
   ```
   è®¿é—®ï¼šhttp://ä½ çš„IP/
   æœŸæœ›ï¼šèƒ½çœ‹åˆ°é¦–é¡µ
   ```

2. **ç®¡ç†åå°**
   ```
   è®¿é—®ï¼šhttp://ä½ çš„IP/admin/index.html
   æœŸæœ›ï¼šèƒ½çœ‹åˆ°ç®¡ç†é¡µé¢
   ```

3. **Range è¯·æ±‚ï¼ˆæœ€é‡è¦ï¼ï¼‰**
   ```bash
   curl -I -H "Range: bytes=0-1023" http://ä½ çš„IP/models/æ–‡ä»¶.ply
   æœŸæœ›ï¼šçŠ¶æ€ç  206 + Accept-Ranges: bytes
   ```

4. **æµè§ˆå™¨æµ‹è¯•**
   ```
   F12 â†’ Network â†’ åŠ è½½ PLY æ¨¡å‹
   æœŸæœ›ï¼šStatus Code: 206 Partial Content
   ```

5. **æ¨¡å‹åŠ è½½**
   ```
   è®¿é—®å±•ç¤ºé¡µé¢ â†’ ç‚¹å‡» PLY æ¨¡å‹
   æœŸæœ›ï¼šè¿›åº¦ä» 0% â†’ 100%ï¼Œæ¨¡å‹æ­£å¸¸æ˜¾ç¤º
   ```

---

## ğŸ“‹ Nginx é…ç½®ç²¾ç®€ç‰ˆï¼ˆå¤åˆ¶ç²˜è´´ç”¨ï¼‰

```nginx
server {
    listen 80;
    server_name ä½ çš„IPæˆ–åŸŸå;  # â† æ”¹è¿™é‡Œ
    
    client_max_body_size 500M;
    client_body_timeout 600s;
    
    # æ¨¡å‹æ–‡ä»¶ - æ ¸å¿ƒé…ç½®
    location /models/ {
        alias /www/wwwroot/3dModeldisplay/public/models/;
        
        # ä¸‰ä¸ªå…³é”®é…ç½®
        add_header Accept-Ranges bytes always;
        add_header Access-Control-Allow-Origin * always;
        add_header Access-Control-Expose-Headers "Accept-Ranges, Content-Length, Content-Range" always;
        
        types {
            application/octet-stream ply;
            model/obj obj;
            application/octet-stream stl;
        }
        
        expires 30d;
        sendfile on;
    }
    
    # ç¼©ç•¥å›¾
    location /images/ {
        alias /www/wwwroot/3dModeldisplay/public/images/;
        add_header Access-Control-Allow-Origin * always;
        expires 30d;
    }
    
    # API è·¯ç”±
    location /api/ {
        proxy_pass http://127.0.0.1:3000/api/;
        proxy_request_buffering off;
        proxy_read_timeout 600s;
    }
    
    # ç®¡ç†åå°
    location /admin/ {
        proxy_pass http://127.0.0.1:3000/admin/;
        proxy_request_buffering off;
        proxy_read_timeout 600s;
    }
    
    # é»˜è®¤è·¯ç”±
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header Range $http_range;
        proxy_buffering off;
    }
}
```

---

## ğŸ”‘ å…³é”®è·¯å¾„å¯¹ç…§è¡¨

| ç”¨é€” | å®å¡”è·¯å¾„ |
|-----|---------|
| é¡¹ç›®æ ¹ç›®å½• | `/www/wwwroot/3dModeldisplay/` |
| æ¨¡å‹æ–‡ä»¶ | `/www/wwwroot/3dModeldisplay/public/models/` |
| ç¼©ç•¥å›¾ | `/www/wwwroot/3dModeldisplay/public/images/` |
| é…ç½®æ–‡ä»¶ | `/www/wwwroot/3dModeldisplay/data/models.json` |
| Nginx é…ç½® | ç½‘ç«™è®¾ç½® â†’ é…ç½®æ–‡ä»¶ |
| æ—¥å¿—æ–‡ä»¶ | `/www/wwwroot/3dModeldisplay/logs/` |

---

## ğŸ“ è·å–å¸®åŠ©æ—¶éœ€è¦æä¾›

1. æµè§ˆå™¨ F12 æ§åˆ¶å°æˆªå›¾
2. PM2 æ—¥å¿—ï¼š`pm2 logs 3d-model-display --lines 50`
3. Nginx é”™è¯¯æ—¥å¿—ï¼šç½‘ç«™ â†’ æ—¥å¿—
4. curl æµ‹è¯•ç»“æœï¼ˆè§ä¸Šæ–¹å‘½ä»¤ï¼‰

---

**æ‰“å°æœ¬é¡µï¼Œéƒ¨ç½²æ—¶æ›´æ–¹ä¾¿ï¼** ğŸ“„

